function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

import dgram from "dgram";
import EventEmitter from "events";
import { PacketHeader, PacketSessionData, PacketMotionData, PacketLapData, PacketEventData, PacketParticipantsData, PacketCarSetupData, PacketCarTelemetryData, PacketCarStatusData } from "./parsers/packets";
import { Packets, PACKETS, DRIVERS, TRACKS, TEAMS } from "./constants";

/**
 *
 */
class F1TelemetryClient extends EventEmitter {
  constructor(opts = {}) {
    super();

    _defineProperty(this, "port", void 0);

    _defineProperty(this, "client", void 0);

    const {
      port = 20777
    } = opts;
    this.port = port;
    this.client = dgram.createSocket("udp4");
  }
  /**
   *
   * @param {Buffer} buffer
   */


  static parsePacketHeader(buffer) {
    const ph = new PacketHeader();
    return ph.fromBuffer(buffer);
  }
  /**
   *
   * @param {Number} packetId
   */


  static getParserByPacketId(packetId) {
    const packetType = PACKETS[packetId];

    if (packetType === Packets.SESSION) {
      return PacketSessionData;
    }

    if (packetType === Packets.MOTION) {
      return PacketMotionData;
    }

    if (packetType === Packets.LAP_DATA) {
      return PacketLapData;
    }

    if (packetType === Packets.EVENT) {
      return PacketEventData;
    }

    if (packetType === Packets.PARTICIPANTS) {
      return PacketParticipantsData;
    }

    if (packetType === Packets.CAR_SETUPS) {
      return PacketCarSetupData;
    }

    if (packetType === Packets.CAR_TELEMETRY) {
      return PacketCarTelemetryData;
    }

    if (packetType === Packets.CAR_STATUS) {
      return PacketCarStatusData;
    }

    return null;
  }
  /**
   *
   * @param {Buffer} message
   */


  parseMessage(message) {
    const buffer = Buffer.from(message.buffer);
    const {
      m_packetId
    } = F1TelemetryClient.parsePacketHeader(buffer); // eslint-disable-line

    const Parser = F1TelemetryClient.getParserByPacketId(m_packetId);

    if (Parser !== null) {
      const packetData = new Parser(buffer);
      this.emit(PACKETS[m_packetId], packetData.data);
    }
  }
  /**
   * Method to start listening for packets
   */


  start() {
    this.client.on("listening", () => {
      const address = this.client.address();
      console.log(`UDP Client listening on ${address.address}:${address.port} üèé`);
      this.client.setBroadcast(true);
    });
    this.client.on("message", m => this.parseMessage(m));
    this.client.bind(this.port);
  }
  /**
   * Method to close the client
   */


  stop() {
    return this.client.close(() => {
      console.log(`UDP Client closed üèÅ`);
    });
  }

}

export { F1TelemetryClient, Packets, DRIVERS, TRACKS, TEAMS };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC50cyJdLCJuYW1lcyI6WyJkZ3JhbSIsIkV2ZW50RW1pdHRlciIsIlBhY2tldEhlYWRlciIsIlBhY2tldFNlc3Npb25EYXRhIiwiUGFja2V0TW90aW9uRGF0YSIsIlBhY2tldExhcERhdGEiLCJQYWNrZXRFdmVudERhdGEiLCJQYWNrZXRQYXJ0aWNpcGFudHNEYXRhIiwiUGFja2V0Q2FyU2V0dXBEYXRhIiwiUGFja2V0Q2FyVGVsZW1ldHJ5RGF0YSIsIlBhY2tldENhclN0YXR1c0RhdGEiLCJQYWNrZXRzIiwiUEFDS0VUUyIsIkRSSVZFUlMiLCJUUkFDS1MiLCJURUFNUyIsIkYxVGVsZW1ldHJ5Q2xpZW50IiwiY29uc3RydWN0b3IiLCJvcHRzIiwicG9ydCIsImNsaWVudCIsImNyZWF0ZVNvY2tldCIsInBhcnNlUGFja2V0SGVhZGVyIiwiYnVmZmVyIiwicGgiLCJmcm9tQnVmZmVyIiwiZ2V0UGFyc2VyQnlQYWNrZXRJZCIsInBhY2tldElkIiwicGFja2V0VHlwZSIsIlNFU1NJT04iLCJNT1RJT04iLCJMQVBfREFUQSIsIkVWRU5UIiwiUEFSVElDSVBBTlRTIiwiQ0FSX1NFVFVQUyIsIkNBUl9URUxFTUVUUlkiLCJDQVJfU1RBVFVTIiwicGFyc2VNZXNzYWdlIiwibWVzc2FnZSIsIkJ1ZmZlciIsImZyb20iLCJtX3BhY2tldElkIiwiUGFyc2VyIiwicGFja2V0RGF0YSIsImVtaXQiLCJkYXRhIiwic3RhcnQiLCJvbiIsImFkZHJlc3MiLCJjb25zb2xlIiwibG9nIiwic2V0QnJvYWRjYXN0IiwibSIsImJpbmQiLCJzdG9wIiwiY2xvc2UiXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBT0EsS0FBUCxNQUE4QixPQUE5QjtBQUNBLE9BQU9DLFlBQVAsTUFBeUIsUUFBekI7QUFFQSxTQUNFQyxZQURGLEVBRUVDLGlCQUZGLEVBR0VDLGdCQUhGLEVBSUVDLGFBSkYsRUFLRUMsZUFMRixFQU1FQyxzQkFORixFQU9FQyxrQkFQRixFQVFFQyxzQkFS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QVEsSUFBR0EsT0FBTyxDQUFDN0IsSUFBSyxLQUQ3RDtBQUdBLFdBQUtDLE1BQUwsQ0FBWStCLFlBQVosQ0FBeUIsSUFBekI7QUFDRCxLQU5EO0FBUUEsU0FBSy9CLE1BQUwsQ0FBWTJCLEVBQVosQ0FBZSxTQUFmLEVBQTBCSyxDQUFDLElBQUksS0FBS2YsWUFBTCxDQUFrQmUsQ0FBbEIsQ0FBL0I7QUFDQSxTQUFLaEMsTUFBTCxDQUFZaUMsSUFBWixDQUFpQixLQUFLbEMsSUFBdEI7QUFDRDtBQUVEOzs7OztBQUdBbUMsRUFBQUEsSUFBSSxHQUFHO0FBQ0wsV0FBTyxLQUFLbEMsTUFBTCxDQUFZbUMsS0FBWixDQUFrQixNQUFNO0FBQzdCTixNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBYSxzQkFBYjtBQUNELEtBRk0sQ0FBUDtBQUdEOztBQXRHMEM7O0FBeUc3QyxTQUFTbEMsaUJBQVQsRUFBNEJMLE9BQTVCLEVBQXFDRSxPQUFyQyxFQUE4Q0MsTUFBOUMsRUFBc0RDLEtBQXREIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGRncmFtLCB7IFNvY2tldCB9IGZyb20gXCJkZ3JhbVwiO1xuaW1wb3J0IEV2ZW50RW1pdHRlciBmcm9tIFwiZXZlbnRzXCI7XG5cbmltcG9ydCB7XG4gIFBhY2tldEhlYWRlcixcbiAgUGFja2V0U2Vzc2lvbkRhdGEsXG4gIFBhY2tldE1vdGlvbkRhdGEsXG4gIFBhY2tldExhcERhdGEsXG4gIFBhY2tldEV2ZW50RGF0YSxcbiAgUGFja2V0UGFydGljaXBhbnRzRGF0YSxcbiAgUGFja2V0Q2FyU2V0dXBEYXRhLFxuICBQYWNrZXRDYXJUZWxlbWV0cnlEYXRhLFxuICBQYWNrZXRDYXJTdGF0dXNEYXRhXG59IGZyb20gXCIuL3BhcnNlcnMvcGFja2V0c1wiO1xuXG5pbXBvcnQgeyBQYWNrZXRzLCBQQUNLRVRTLCBEUklWRVJTLCBUUkFDS1MsIFRFQU1TIH0gZnJvbSBcIi4vY29uc3RhbnRzXCI7XG5pbXBvcnQgeyBJT3B0aW9ucyB9IGZyb20gXCIuL3R5cGVzXCI7XG5pbXBvcnQgeyBQYXJzZXIgfSBmcm9tIFwiYmluYXJ5LXBhcnNlclwiO1xuaW1wb3J0IHsgQWRkcmVzc0luZm8gfSBmcm9tIFwibmV0XCI7XG5cbi8qKlxuICpcbiAqL1xuY2xhc3MgRjFUZWxlbWV0cnlDbGllbnQgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuICBwb3J0OiBudW1iZXI7XG4gIGNsaWVudDogU29ja2V0O1xuXG4gIGNvbnN0cnVjdG9yKG9wdHM6IElPcHRpb25zID0ge30pIHtcbiAgICBzdXBlcigpO1xuICAgIGNvbnN0IHsgcG9ydCA9IDIwNzc3IH0gPSBvcHRzO1xuXG4gICAgdGhpcy5wb3J0ID0gcG9ydDtcbiAgICB0aGlzLmNsaWVudCA9IGRncmFtLmNyZWF0ZVNvY2tldChcInVkcDRcIik7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHtCdWZmZXJ9IGJ1ZmZlclxuICAgKi9cbiAgc3RhdGljIHBhcnNlUGFja2V0SGVhZGVyKGJ1ZmZlcjogQnVmZmVyKTogUGFyc2VyLlBhcnNlZDxhbnk+IHtcbiAgICBjb25zdCBwaCA9IG5ldyBQYWNrZXRIZWFkZXIoKTtcbiAgICByZXR1cm4gcGguZnJvbUJ1ZmZlcihidWZmZXIpO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBwYWNrZXRJZFxuICAgKi9cbiAgc3RhdGljIGdldFBhcnNlckJ5UGFja2V0SWQocGFja2V0SWQ6IG51bWJlcikge1xuICAgIGNvbnN0IHBhY2tldFR5cGUgPSBQQUNLRVRTW3BhY2tldElkXTtcblxuICAgIGlmIChwYWNrZXRUeXBlID09PSBQYWNrZXRzLlNFU1NJT04pIHtcbiAgICAgIHJldHVybiBQYWNrZXRTZXNzaW9uRGF0YTtcbiAgICB9XG5cbiAgICBpZiAocGFja2V0VHlwZSA9PT0gUGFja2V0cy5NT1RJT04pIHtcbiAgICAgIHJldHVybiBQYWNrZXRNb3Rpb25EYXRhO1xuICAgIH1cblxuICAgIGlmIChwYWNrZXRUeXBlID09PSBQYWNrZXRzLkxBUF9EQVRBKSB7XG4gICAgICByZXR1cm4gUGFja2V0TGFwRGF0YTtcbiAgICB9XG5cbiAgICBpZiAocGFja2V0VHlwZSA9PT0gUGFja2V0cy5FVkVOVCkge1xuICAgICAgcmV0dXJuIFBhY2tldEV2ZW50RGF0YTtcbiAgICB9XG5cbiAgICBpZiAocGFja2V0VHlwZSA9PT0gUGFja2V0cy5QQVJUSUNJUEFOVFMpIHtcbiAgICAgIHJldHVybiBQYWNrZXRQYXJ0aWNpcGFudHNEYXRhO1xuICAgIH1cblxuICAgIGlmIChwYWNrZXRUeXBlID09PSBQYWNrZXRzLkNBUl9TRVRVUFMpIHtcbiAgICAgIHJldHVybiBQYWNrZXRDYXJTZXR1cERhdGE7XG4gICAgfVxuXG4gICAgaWYgKHBhY2tldFR5cGUgPT09IFBhY2tldHMuQ0FSX1RFTEVNRVRSWSkge1xuICAgICAgcmV0dXJuIFBhY2tldENhclRlbGVtZXRyeURhdGE7XG4gICAgfVxuXG4gICAgaWYgKHBhY2tldFR5cGUgPT09IFBhY2tldHMuQ0FSX1NUQVRVUykge1xuICAgICAgcmV0dXJuIFBhY2tldENhclN0YXR1c0RhdGE7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHtCdWZmZXJ9IG1lc3NhZ2VcbiAgICovXG4gIHBhcnNlTWVzc2FnZShtZXNzYWdlOiBCdWZmZXIpIHtcbiAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbShtZXNzYWdlLmJ1ZmZlcik7XG5cbiAgICBjb25zdCB7IG1fcGFja2V0SWQgfSA9IEYxVGVsZW1ldHJ5Q2xpZW50LnBhcnNlUGFja2V0SGVhZGVyKGJ1ZmZlcik7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgICBjb25zdCBQYXJzZXIgPSBGMVRlbGVtZXRyeUNsaWVudC5nZXRQYXJzZXJCeVBhY2tldElkKG1fcGFja2V0SWQpO1xuXG4gICAgaWYgKFBhcnNlciAhPT0gbnVsbCkge1xuICAgICAgY29uc3QgcGFja2V0RGF0YSA9IG5ldyBQYXJzZXIoYnVmZmVyKTtcbiAgICAgIHRoaXMuZW1pdChQQUNLRVRTW21fcGFja2V0SWRdLCBwYWNrZXREYXRhLmRhdGEpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBNZXRob2QgdG8gc3RhcnQgbGlzdGVuaW5nIGZvciBwYWNrZXRzXG4gICAqL1xuICBzdGFydCgpIHtcbiAgICB0aGlzLmNsaWVudC5vbihcImxpc3RlbmluZ1wiLCAoKSA9PiB7XG4gICAgICBjb25zdCBhZGRyZXNzID0gdGhpcy5jbGllbnQuYWRkcmVzcygpIGFzIEFkZHJlc3NJbmZvO1xuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIGBVRFAgQ2xpZW50IGxpc3RlbmluZyBvbiAke2FkZHJlc3MuYWRkcmVzc306JHthZGRyZXNzLnBvcnR9IPCfj45gXG4gICAgICApO1xuICAgICAgdGhpcy5jbGllbnQuc2V0QnJvYWRjYXN0KHRydWUpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5jbGllbnQub24oXCJtZXNzYWdlXCIsIG0gPT4gdGhpcy5wYXJzZU1lc3NhZ2UobSkpO1xuICAgIHRoaXMuY2xpZW50LmJpbmQodGhpcy5wb3J0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNZXRob2QgdG8gY2xvc2UgdGhlIGNsaWVudFxuICAgKi9cbiAgc3RvcCgpIHtcbiAgICByZXR1cm4gdGhpcy5jbGllbnQuY2xvc2UoKCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coYFVEUCBDbGllbnQgY2xvc2VkIPCfj4FgKTtcbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgeyBGMVRlbGVtZXRyeUNsaWVudCwgUGFja2V0cywgRFJJVkVSUywgVFJBQ0tTLCBURUFNUyB9O1xuIl19